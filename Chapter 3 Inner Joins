/*
前面的章节都是只选择了一张表格
这一章模拟的是应用多张表格
*/
# 3.1 Inner Join 内连接
-- 这一课教的是连接两个表格的方法
-- 这里的应用是选取orders和customers的customer_id并连接
-- 以此得到同一个顾客下的不同订单
SELECT order_id, o.customer_id, first_name, last_name
-- 这里要指定customer_id来自于哪个表，因为两个表都有此列
-- 不指明的话会报错‘ambiguous’
FROM sql_store.orders AS o -- AS可以省略
INNER JOIN customers AS c -- AS可以省略, INNER也可以省略
		ON o.customer_id = c.customer_id

# 练习3.1
-- 	对照order items表，和products表连接
-- 每笔订单都返回订单id，产品id和名字，连同order items表的数量和单价
SELECT  order_id, oi.product_id, name, quantity, oi.unit_price -- order_id仅在oi表出现，无需指定
FROM order_items AS oi
INNER JOIN products AS pd
	ON oi.product_id = pd.product_id
-- 简洁版：
SELECT order_id, oi.product_id, name, quantity, oi.unit_price
FROM order_items oi
JOIN products p
  ON oi.product_id = p.product_id

# 3.2 Joining Across Databases 跨数据库连接
-- 假设要将(1)sql_store的order_items表
-- 和(2)sql_inventory的products表连接
USE sql_store; 
SELECT *
FROM order_items oi
-- 因为在课程开始选择的就是sql_store的数据库
-- 所以第一行order_item不用指定数据库
-- 只需要给不在当前数据库的表加前缀
JOIN sql_inventory.products p
	ON oi.product_id = p.product_id

# 3.3 Self Joins
-- 将一个表自己连接自己称之为自连接
-- 和内连接操作大抵相同
-- 只是需要注意给表添加不同别称即可
USE sql_hr; 

SELECT 
	e.employee_id, 
    	e.first_name AS employee, 
--    	e.last_name, 
--    	e.job_title, 
--    	e.reports_to, 
    	m.first_name AS manager
FROM employees e
JOIN employees m
	ON e.reports_to = m.employee_id

# 3.4 Joining Multiple Tables
-- 为了制造一个简洁的包含订单id，用户姓名以及订单状态的表格
-- 需要连接来自customers的姓名，orders的order_id, order_statues的状态
-- 自己先写一遍！
USE sql_store; 

SELECT order_id, order_date, c.first_name, c.last_name, os.name
FROM orders o
JOIN customers c
	ON c.customer_id = o.customer_id
JOIN order_statuses os
	ON o.status = os.order_status_id
ORDER BY name, order_id

-- 老师写的：
SELECT 
	order_id, 
    order_date, 
    c.first_name, 
    c.last_name, 
    os.name AS status
FROM orders o
JOIN customers c
	ON c.customer_id = o.customer_id
JOIN order_statuses os
	ON o.status = os.order_status_id
ORDER BY name, order_id

# 练习3.4
-- 从sql_invoicing连接必要的表格
-- 制造一张含有顾客姓名，付款方式，日期的表格
-- 因为题目没有明确需求，自己发挥选择什么列来制造表格

USE sql_invoicing; 

SELECT 
 	p.payment_id, 
--	p.invoice_id
    p.date, 
    c.name AS client_name, 
    p.amount, 
    pm.name AS payment_method
FROM payments p
JOIN payment_methods pm
	ON p.payment_method = pm.payment_method_id
JOIN clients c
	ON p.client_id = c.client_id
